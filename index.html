<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <link rel="stylesheet" type="text/css" href="stylesheets/my.css">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>sql-track-change by jeffreypolk</title>
</head>

<body>
    <header>
        <div class="inner">
            <h1>sql-track-change</h1>
            <h2>Track and replicate DML changes</h2>
            <a href="https://github.com/jeffreypolk/sql-track-change" class="button"><small>View project on</small> GitHub</a>
        </div>
    </header>

    <div id="content-wrapper">
        <div class="inner clearfix">
            <section id="main-content">

                <!-- Overview -->
                <div>
                    <h3>
                        <a id="UseCase" class="anchor" href="#UseCase" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Use Case
                    </h3>
                    <p>
                        I want to make a series of data changes to a database (source). At some point in the future, 
                        I want to generate SQL scripts that will apply all of the changes that I've made to the 
                        source database to another database (target). This will be useful when configuring a test system, 
                        and I want to generate scripts to propagate all the changes I made in test to the production database.
                    </p>
                </div>

                <!-- Implementation -->
                <div>
                    <h3>
                        <a id="Implementation" class="anchor" href="#Implementation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Implementation
                    </h3>
                    <p>
                        This solution uses a table for configuration of what is tracked, and a couple stored procedures 
                        for enabling/disabling tracking and extracting SQL statements for all the changes made. 
                        It uses the <a href="https://msdn.microsoft.com/en-us/library/bb933875.aspx" target="_blank">SQL Server Change Tracking</a> feature introduced in SQL Server 2008. 
                        It also uses the <a href="https://github.com/drumsta/sql-generate-insert" target="_blank">GenerateInsert project</a> by <a href="https://github.com/drumsta" target="_blank">@drumsta</a>.
                    </p>
                </div>

                <!-- Installation -->
                <div>
                    <h3>
                        <a id="Installation" class="anchor" href="#Installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Installation
                    </h3>
                    <p>
                        Execute the <span class="code">Install.sql</span> script to create the table and stored procedures. The configuration
                        table <span class="code">dbo.TrackChangeConfig</span> will be prepopulated with all tables from the database.
                    </p>
                </div>

                <!-- Configuration -->
                <div>
                    <h3>
                        <a id="Configuration" class="anchor" href="#Configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Configuration
                    </h3>
                    <p>
                        Configuration is stored in the <span class="code">dbo.TrackChangeConfig</span> table. Tracking is an opt-in operation.
                        Set the <span class="code">TrackChanges</span> column to 1 for each table to track. If the table contains an identity column,
                        you can set the <span class="code">IdentityIncrement</span> column. If set, the table will be reseeded to the
                        current value plus this increment when tracking is started. This option creates a buffer
                        between the records in the source database and the records in the target database.
                        This is to avoid Id conflicts when the script is executed in the target database.
                    </p>
                </div>

                <!-- Begin Tracking -->
                <div>
                    <h3>
                        <a id="BeginTracking" class="anchor" href="#BeginTracking" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Begin Tracking
                    </h3>
                    <p>
                        Execute the <span class="code">dbo.uspTrackChangeStart</span> stored procedure. 
                        This will turn on change tracking at the database level and enable tracking 
                        on each table configured for tracking.  If a table has an <span class="code">IdentityIncrement</span> value, 
                        the table will be reseeded.  SQL Server Change Tracking is set to retain changes for 365 days.
                    </p>
                    <p>
                        The tables tracked in the source should be locked down in the target.  If changes are made 
                        in the target between start and extract in the source, then data intregrity in the target is at risk.
                    </p>
                </div>

                <!-- Make Changes -->
                <div>
                    <h3>
                        <a id="MakeChanges" class="anchor" href="#MakeChanges" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Make Changes
                    </h3>
                    <p>
                        Set it and forget it. SQL Server Change Tracking will keep track of all the changes automatically.
                    </p>
                </div>

                <!-- Generation Scripts -->
                <div>
                    <h3>
                        <a id="GenerationScripts" class="anchor" href="#GenerateScripts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Generate Scripts
                    </h3>
                    <p>
                        After changes are completed or at a checkpoint, execute the <span class="code">dbo.uspTrackChangeExtract</span> stored procedure.
                        This will generate delete/insert statements needed to propagate all stored changes to the target database.
                        This procedure always begins with the changes made since the <span class="code">dbo.uspTrackChangeStart</span> procedure was called.
                    </p>
                </div>

                <!-- Stop Tracking -->
                <div>
                    <h3>
                        <a id="StopTracking" class="anchor" href="#StopTracking" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Stop Tracking
                    </h3>
                    <p>
                        Execute the <span class="code">dbo.uspTrackChangeStop</span> stored procedure to stop tracking on all tables and the database.
                        Once tracking is stopped, all history is purged.
                    </p>
                </div>

                <!-- Uninstall -->
                <div>
                    <h3>
                        <a id="Uninstall" class="anchor" href="#Uninstall" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Uninstall
                    </h3>
                    <p>
                        Execute the <span class="code">Uninstall.sql</span> script to remove the table and stored procedures from the database.
                    </p>

                </div>

                <!-- Limitations -->
                <div>
                    <h3>
                        <a id="Limitations" class="anchor" href="#Limitations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
                        Limitations
                    </h3>
                    <p>
                        <ol>
                            <li>A table must have a primary key for its data to be tracked</li>
                            <li>This tool only supports composite primary keys with three or less columns</li>
                        </ol>
                    </p>

                </div>
        </section>

            <aside id="sidebar">
                <a href="https://github.com/jeffreypolk/sql-track-change/zipball/master" class="button">
                    <small>Download</small>
                    .zip file
                </a>
                <a href="https://github.com/jeffreypolk/sql-track-change/tarball/master" class="button">
                    <small>Download</small>
                    .tar.gz file
                </a>

                <p class="repo-owner"><a href="https://github.com/jeffreypolk/sql-track-change"></a> is maintained by <a href="https://github.com/jeffreypolk">jeffreypolk</a>.</p>

                <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
        </div>
    </div>


</body>
</html>
